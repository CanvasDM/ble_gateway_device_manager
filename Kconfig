#
# Copyright (c) 2022 Laird Connectivity LLC
#
# SPDX-License-Identifier: LicenseRef-LairdConnectivity-Clause
#
menuconfig LCZ_BLE_GW_DM
	bool "LC BLE Gateway Device Manager"
	depends on LCZ_NETWORK_MONITOR
	depends on FRAMEWORK
	depends on LCZ_LWM2M_CLIENT

if LCZ_BLE_GW_DM

module=LCZ_BLE_GW_DM
module-str=LCZ_BLE_GW_DM
source "subsys/logging/Kconfig.template.log_config"

config LCZ_BLE_GW_DM_THREAD_PRIORITY
	int "Preemptible thread priority"
	range 0 NUM_PREEMPT_PRIORITIES
	default 0

config LCZ_BLE_GW_DM_THREAD_STACK_SIZE
	int "Stack size"
	default 2048

config LCZ_BLE_GW_DM_CLIENT_INDEX
    int "Client index for DM LwM2M connection"
	default 0

config LCZ_BLE_GW_DM_CONNECTION_TIMEOUT
	int "DM connection timeout"
	default 60
	help
	  Time in seconds to wait for connection timeout before restarting
	  the connection sequence.

config LCZ_BLE_GW_DM_WAIT_FOR_NETWORK_TIMEOUT
	int "Wait for network timeout"
	default 60
	help
	  Time in seconds to wait for the network to be ready before forcing
	  a re-check.

choice
	prompt "Init mode"
	default LCZ_BLE_GW_DM_INIT_KCONFIG

config LCZ_BLE_GW_DM_INIT_KCONFIG
	bool "Kconfig"
	help
	  Use Kconfig settings to init service.

config LCZ_BLE_GW_DM_INIT_ATTRIBUTES
	bool "Attributes"
	depends on ATTR
	select LCZ_BLE_GW_DM_ENABLE_ATTRIBUTES
	help
	  Use attributes system to init service.

endchoice

config LCZ_BLE_GW_DM_ENABLE_ATTRIBUTES
	bool "Enable attributes"
	depends on ATTR
	help
	  Enable attributes system for settings.

if LCZ_BLE_GW_DM_INIT_KCONFIG

config LCZ_BLE_GW_DM_CONNECTION_DELAY
	int "DM connection delay"
	default 5
	help
	  Time in seconds to delay before connecting to device management
	  services after the network connection is ready.

endif # LCZ_BLE_GW_DM_INIT_KCONFIG

menuconfig LCZ_BLE_GW_DM_MEMFAULT
	bool "Memfault data reporting"
	depends on LCZ_MEMFAULT
	depends on FILE_SYSTEM_UTILITIES

if LCZ_BLE_GW_DM_MEMFAULT

config LCZ_BLE_GW_DM_MEMFAULT_THREAD_PRIORITY
	int "Preemptible thread priority"
	range 0 NUM_PREEMPT_PRIORITIES
	default 0

config LCZ_BLE_GW_DM_MEMFAULT_THREAD_STACK_SIZE
	int "Stack size"
	default 3072

config LCZ_BLE_GW_DM_MEMFAULT_REPORT_PERIOD_SECONDS
	int "Report period"
	default 3600
	help
	  How often to periodically push memfault data (in seconds)

config LCZ_BLE_GW_DM_MEMFAULT_CHUNK_BUF_SIZE
	int "Chunk buffer size"
	default 2048
	help
	  Size of the buffer used to post/save memfault data

config LCZ_BLE_GW_DM_MEMFAULT_FILE_NAME
	string "Memfault data file name"
	default "mflt.bin"
	help
	  File name where Memfault data will be saved

config LCZ_BLE_GW_DM_MEMFAULT_FILE_MAX_SIZE_BYTES
	int "Memfault data file max size"
	default 512000
	help
	  If the file grows past this size it will be deleted and re-created

endif # LCZ_BLE_GW_DM_MEMFAULT

if MODEM_HL7800

config LCZ_BLE_GW_DM_HL7800_INIT_PRIORITY
    int "Application init priority for hl7800"
    range 0 99
    default APPLICATION_INIT_PRIORITY

endif # MODEM_HL7800

if BT
config LCZ_BLE_GW_DM_BLE_ADDR_INIT_PRIORITY
    int "BLE address init priority"
    range 0 99
    default APPLICATION_INIT_PRIORITY
    help
      Application init priority for BLE address
endif # BT

endif # LCZ_BLE_GW_DM
